{% extends '../common/layout.html' %}

{% block style %}
<!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css" />-->
<link rel="stylesheet" type="text/css" href="/static/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css" href="/static/css/page_api.css" />
{% endblock %}

{% block body %}

<div class="column_api">
	<div class="_left" id="js_column_api_left">
		{% include './_left.html' %}
	</div>
	<div class="_right">
		<div class="jumbotron column_apilist_header">
			<h1>
				{{data.name}}<br>
				<!--<span>分类：<font id="js_fx_html"></font></span>-->

				<span>
					版本号：
					<select id="js_version_select" class="form-control form-control-sm" autocomplete="off" style="width: auto; display: inline-block">
						{% for item in versionList %}
							<option value="{{item.id}}" {%if query.v_id==item.id %}selected{%endif%}>{{item.name}}</option>
						{% endfor %}
					</select>
				</span>
				<span>&nbsp;&nbsp;|&nbsp;&nbsp;接口数量：{{apiList.length}}</span>
				<!--<span>&nbsp;&nbsp;|&nbsp;&nbsp;<a href=""></a></span>-->
				<!--<span>|&nbsp;&nbsp;<a href="javascript:void(0)" data-toggle="modal" data-target="#swaggerDialog" data-whatever="@getbootstrap">导入/导出</a></span>-->


				<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
				<div class="btn-group">
					<button type="button" class="btn btn-sm btn-info btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						操作
					</button>
					<div class="dropdown-menu">
						<a class="dropdown-item" href="/project/update?p_id={{query.p_id}}">编辑项目</a>
						<a class="dropdown-item" href="javascript:void(0)" id="js_swagger">swagger导入</a>
						<a class="dropdown-item" href="/project/group/swagger_history?id={{query.g_id}}">导入记录</a>
						<a class="dropdown-item" href="javascript:void(0)" id="js_swagger_run">swagger扫描</a>
						<a class="dropdown-item" href="javascript:void(0)" id="js_write_apifunction" data-v_id="{{query.v_id}}" >导出本页api</a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item" href="javascript:void(0)" id="js_del_apis">删除本页api</a>
					</div>
				</div>
				<span>|&nbsp;&nbsp;<a href="/api/create?p_id={{query.p_id}}&v_id={{query.v_id}}&g_id={{query.g_id}}">添加接口</a></span>
			</h1>

			<input type="hidden" id="js_before_text_name" value="{{data.name}}">
			<input type="hidden" id="js_before_text_vname" value="{% for item in versionList %}{%if query.v_id==item.id %}{{item.name}}{%endif%}{% endfor %}">
			<input type="hidden" id="js_before_text_vnumber" value="{{apiList.length}}">
			<!--<div>-->
				<!--<p style="text-align: right; padding-bottom: 20px; color: #999!important;">-->
					<!--<a href="/api/create?p_id={{query.p_id}}&v_id={{query.v_id}}&g_id={{query.g_id}}">添加接口</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
					<!--{% if query.g_id %}-->
						<!--<a href="#" id="js_swagger">swagger导入</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
						<!--<a href="/project/group/swagger_history?id={{query.g_id}}">导入记录</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
						<!--<a href="#" id="js_swagger_run">swagger扫描</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
					<!--{% endif %}-->
					<!--<a href="#" id="js_write_apifunction" data-v_id="{{query.v_id}}" data-back_url="{{apiFunctionBackUrl}}">导出ApiFunction</a>&nbsp;&nbsp;&nbsp;&nbsp;-->
					<!--<a href="#" id="js_del_apis">删除所有api</a>-->
				<!--</p>-->
			<!--</div>-->
		</div>
		<div class="table_box">
			<!--<table class="table table-bordered table-hover">-->
			<table class="table table-striped table-hover table-api" id="example" class="display" cellspacing="0" width="100%">
				<thead>
					<tr>
						<th width="25%">接口名称</th>
						<th width="25%">接口URL</th>
						<th width="10%">functionName</th>
						<th width="10%">创建时间</th>
						<th width="10%">最后修改</th>
						<th width="20%">操作</th>
					</tr>
				</thead>
				<tbody>
					{%for item in apiList %}
						<tr>
							<td class="api_id" data-id="{{item.id}}" style="max-width: 250px;" title="{{item.name}}">{{item.name}}</td>
							<td title="{{item.url}}">
								{% if item.request_type==1 %}
									<span class="btn btn-sm btn-type btn-info">POST</span>
								{% elseif item.request_type==2 %}
									<span class="btn btn-sm btn-type btn-success">GET</span>
								{% elseif item.request_type==3 %}
									<span class="btn btn-sm btn-type btn-primary">PUT</span>
								{% elseif item.request_type==4 %}
									<span class="btn btn-sm btn-type btn-danger">DELETE</span>
								{% elseif item.request_type==7 %}
									<span class="btn btn-sm btn-type btn-warning">PATCH</span>
								{% endif %}<br>
								{{item.url}}
							</td>
							<td style="max-width: 100px;">
								{% if item.fun_name %}
									<span title="{{item.fun_name}}" style="color: #58c760;">{{item.fun_name}}</span>
								{% elseif item.swagger_id %}
									<span title="{{item.swagger_id}}" style="color: #999;">{{item.swagger_id}}</span>
								{% else %}
									<span title="{{item.id}}" style="color: #999;">{{item.id}}</span>
								{% endif %}
							</td>
							<td title="{{item.create_time | date('Y-m-d H:i:s', -480)}} ({{item.create_name}})" {% if query.sort!=undefined&&query.sort=="update" %}style="color: #999; max-width: 120px;"{%else%}style="max-width: 120px; color: #999;"{%endif%}>
								{{item.create_time | date('Y-m-d H:i:s', -480)}}
								<!--<br>({{item.create_name}})-->
							</td>
							<td title="{{item.update_time | date('Y-m-d H:i:s', -480)}} ({{item.update_name}})" {% if query.sort!=undefined&&query.sort=="update" %}style="max-width: 120px; color: #999;"{%else%}style="color: #999; max-width: 120px;"{%endif%}>
								{{item.update_time | date('Y-m-d H:i:s', -480)}}
								<!--<br>
								{% if item.swagger_upinfo %}
									(<a href="javascript:$.sx.alert('{{item.swagger_upinfo}}')">更新记录</a>)
							    {% elseif item.update_name %}({{item.update_name}}){% endif %}</td>-->
							<td class="setting_btn">
								<a href="/api/detail/{{item.id}}" class="btn btn-sm btn-info"><i class="iconfont">&#xe611;</i>查看</a>
								<!--<a href="/api/update?id={{item.id}}" class="btn btn-sm btn-warning">编辑</a>-->
								<a href="/api/test?id={{item.id}}" class="btn btn-sm btn-success"><i class="iconfont">&#xe632;</i>调试</a>
								<a href="javascript:void(0)" data-id="{{item.id}}" class="btn btn-sm btn-danger"><i class="iconfont">&#xe646;</i>删除</a>
							</td>
						</tr>
					{% endfor%}
				</tbody>
			</table>
		</div>
	</div>
</div>
<!--
<div class="modal fade" id="swaggerDialog" tabindex="-1" role="dialog" aria-labelledby="loginDialogLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
					<span class="sr-only">Close</span>
				</button>
				<h4 class="modal-title" id="loginDialogLabel">导入导出</h4>
			</div>
			<div class="modal-body">
				{% if query.g_id %}
				<a href="#" id="js_swagger">swagger导入</a>&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="/project/group/swagger_history?id={{query.g_id}}">导入记录</a>&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="#" id="js_swagger_run">swagger扫描</a>&nbsp;&nbsp;&nbsp;&nbsp;
				{% endif %}
				<a href="#" id="js_write_apifunction" data-v_id="{{query.v_id}}" data-back_url="{{apiFunctionBackUrl}}">导出ApiFunction</a>&nbsp;&nbsp;&nbsp;&nbsp;
				<a href="#" id="js_del_apis">删除所有api</a>
			</div>
		</div>
	</div>
</div>-->





<!--tpl_edit_version-->
<script type="text/html" id="tpl_edit_group">
	<form action="/project/updateGroupPost" class="_form_dialog" id="js_form2" method="post">
		<div class="form-group row">
			<label class="col-sm-3 form-control-label">栏目名称：</label>
			<div class="col-sm-9">
				<input type="text" name="group_name" class="form-control" value="" placeholder="1-24个字符" id="edit_group_name">
			</div>
		</div>
		<div class="form-group row">
			<label class="col-sm-3 form-control-label">栏目排序：</label>
			<div class="col-sm-9">
				<input type="text" name="group_sort" class="form-control form-control-inline" value="" placeholder="输入数字，越大越靠前" id="edit_group_group_sort">
			</div>
		</div>
		<div class="form-group row" id="js_edit_group_servers_api_path_box">
			<label class="col-sm-3 form-control-label">api前缀：</label>
			<div class="col-sm-9">
				<input type="text" name="servers_api_path" class="form-control" value="" placeholder="/xxx/xxx" id="edit_group_servers_api_path">
			</div>
		</div>
		<div class="form-group row" id="js_edit_group_swagger_url_box">
			<label class="col-sm-3 form-control-label">swagger地址：</label>
			<div class="col-sm-9">
				<input type="text" name="swagger_url" class="form-control" value="" placeholder="http://xxx/v2/api-docs" id="edit_group_swagger_url">
			</div>
		</div>
		<input type="hidden" name="group_id" id="edit_group_id">
		<div class="form-group row" style="margin-top: 2rem;">
			<label class="col-sm-3 form-control-label"></label>
			<div class="col-sm-9">
				<a href="javascript:void(0)" class="btn btn-primary btn-lger" id="js_submit2">保存</a>
			</div>
		</div>
	</form>
</script>

<!--tpl_edit_version-->
<script type="text/html" id="tpl_swagger">
	<form action="/makingapi/swaggerImport" class="_form_dialog" id="js_form3" method="post">
		<p style="display: none;">swagger地址：<input type="text" class="input" placeholder="http://192.168.2.82:8012/v2/api-docs" id="swagger_url_input" value=""></p>
		<p style="display: none;"><span style="display: inline-block; width: 100px; line-height: 60px; ">api前缀：</span><input type="text" readonly class="input long readonly" id="js_import_servers_api_path" name="servers_api_path"></p>
		<div class="form-group row">
			<label class="col-sm-3 form-control-label">导入栏目：</label>
			<div class="col-sm-9">
				<input type="text" readonly class="form-control" id="js_import_name">
			</div>
		</div>
		<div class="form-group row">
			<label class="col-sm-3 form-control-label">api地址：</label>
			<div class="col-sm-9">
				<input type="text" readonly class="form-control" id="js_import_swagger_url" name="swagger_url">
			</div>
		</div>
		<div class="form-group row">
			<label class="col-sm-3 form-control-label">强制导入：</label>
			<div class="col-sm-9">
				<select name="must" class="form-control">
					<option value="0">否</option>
					<option value="1">是</option>
				</select>
				<p><font style="color: red; font-size: 12px;">*强制导入会更新所有接口，请谨慎选择！</font></p>
			</div>
		</div>
		<input type="hidden" name="g_id" value="{{query.g_id}}">
		<input type="hidden" name="v_id" value="{{query.v_id}}">
		<input type="hidden" name="p_id" value="{{query.p_id}}">
		<div class="form-group row" style="margin-top: 2rem;">
			<label class="col-sm-3 form-control-label"></label>
			<div class="col-sm-9">
				<a href="javascript:void(0)" class="btn btn-primary btn-lger" id="js_submit3">确定导入</a>
			</div>
		</div>
	</form>
</script>

<!--tpl_edit_version-->
<script type="text/html" id="tpl_swagger2">
	<form action="/makingapi/swaggerRun" id="js_form4" method="post">
		<p><span style="display: inline-block; width: 100px; line-height: 60px;">swagger地址：</span><input type="text" readonly class="input long readonly" id="swagger_url_input2" name="swagger_url"></p>
		<input type="hidden" name="g_id" value="{{query.g_id}}">
		<input type="hidden" name="v_id" value="{{query.v_id}}">
		<input type="hidden" name="p_id" value="{{query.p_id}}">
		<p style="padding: 10px 50px 10px 110px;">
			<a class="btns btns-blue btns-longer" id="js_submit4">确定扫描</a>
		</p>
	</form>
</script>

{% endblock %}

{% block script %}
<script type="text/javascript" src="/static/script/page_api_left.js"></script>
<script type="text/javascript" src="/static/script/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/script/dataTables.bootstrap4.min.js"></script>
<script>
$(function(){
	$('#example').DataTable({
		language: {
			"sProcessing": "处理中...",
			"sLengthMenu": "每页显示 _MENU_ 条数据",
			"sZeroRecords": "没有匹配结果",
			"sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
//			"sInfo": "共 _TOTAL_ 条数据。",
			"sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
			"sInfoFiltered": "(由 _MAX_ 项结果过滤)",
			"sInfoPostFix": "",
			"sSearch": "搜索:",
			"sUrl": "",
			"sEmptyTable": "数据为空！",
			"sLoadingRecords": "载入中...",
			"sInfoThousands": ",",
			"oPaginate": {
				"sFirst": "首页",
				"sPrevious": "上一页",
				"sNext": "下一页",
				"sLast": "末页"
			},
			"oAria": {
				"sSortAscending": ": 以升序排列此列",
				"sSortDescending": ": 以降序排列此列"
			}
		},
		aLengthMenu: [20, 50, 100, 1000],
		iDisplayLength: 100,
		destroy:        true,
		stateSave: 		true, //保存表格状态
		searching: 		true, //搜索
		ordering: 		true, //排序
		columnDefs: [
			{
				targets: [0, 1, 2, 5],
				orderable: false
			}
		],
		paging:			true, //分页
		info: 			false  //数据统计
	});

});
</script>
{% endblock %}