<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>版本管理 - Lookapi</title>
<link rel="stylesheet" type="text/css" href="/static/css/page_index.css" />
</head>

<body>

{% include '../common/header.html' %}

<div class="wrapper">

	<h4 style="padding: 20px 0; border-bottom: 1px solid #ddd;">{{data.name}}</h4>

	<div class="sx_tabs cf">
		<a href="/api/list?p_id={{query.p_id}}">接口文档</a>
		<a href="/project/version?p_id={{query.p_id}}" class="current">版本管理</a>
		<a href="/project/team?p_id={{query.p_id}}">协作管理</a>
		<a href="/project/update?p_id={{query.p_id}}">项目设置</a>
	</div>

	<div class="sc_content">

		<table class="version_table">
			<tr>
				<th>版本号</th>
				<th>api数量</th>
				<th>是否默认</th>
				<th>编辑</th>
			</tr>
			{%for item in versions %}
				<tr>
					<td>{{item.name}}</td>
					<td>10</td>
					<td>
						{%if item.id===data.version_id %}
							<font>默认</font>
						{%endif%}
					</td>
					<td>
						{%if item.id!=data.version_id %}
							<a href="#" data-p_id="{{data.id}}" data-id="{{item.id}}" data-name="{{item.name}}" class="set_default" style="color: #999">设为默认</a>
							<a href="#" data-p_id="{{data.id}}" data-id="{{item.id}}" data-name="{{item.name}}" class="del_version" style="color: red">删除</a>
						{%endif%}
					</td>
				</tr>
			{% endfor%}
			<tr>
				<td colspan="4"><a href="#" id="js_add_version">创建新版本</a></td>
			</tr>
		</table>

		</ul>

	</div>
</div>


<!--tpl_add_version-->
<script type="text/html" id="tpl_add_version">
	<form action="/project/createVersionPost" id="js_form" method="post">
		<p style="padding: 10px 50px;">版本号：<input type="text" name="newversion" class="input" value="" placeholder="输入数字或小数"> *版本号必须为整数或小数格式，版本号创建后不能修改名称</p>
		<p style="padding: 10px 50px 10px 110px;">
			<label class="checkbox">
		        <input type="checkbox"> 复制已有版本api
		    </label>
		</p>
		<input type="hidden" name="p_id" value="{{query.p_id}}">
		<p style="padding: 10px 50px 10px 110px;">
			<a class="btns btns-blue btns-longer" id="js_submit">保存</a>
		</p>
	</form>

</script>


{% include '../common/footer.html' %}
<script>
	$(function(){
		$("#js_add_version").click(function(){
			$.sx.dialog({
				opentitle: "创建新版本",
				html: $("#tpl_add_version").html()
			});
			return false;
		});

		$("body").on("click", "#js_submit", function(){
			$("#js_form").ajaxSubmit({
				success: function(data) {
					console.info(data);
					if(data.status==0){
						$.sx.alert("创建新版本成功，即将刷新页面！");
						setTimeout(function(){
							window.location.reload();
						}, 1500);
					} else {
						$.sx.alert(data.message);
					}
				}
			});
			return false;
		});



		$(".set_default").click(function(){
			console.info("click");
			$.ajax({
				url: "/project/setDefaultVersionPost",
				type: "POST",
				dataType: "json",
				data: {
					p_id: $(this).data("p_id"),
					v_id: $(this).data("id"),
					v_name: $(this).data("name")
				},
				success: function(data){
					if(data.status==0){
						$.sx.alert("操作成功！");
						setTimeout(function(){
							window.location.reload();
						}, 1500);
					} else {
						$.sx.alert(data.message);
					}
				}
			});
			return false;
		});


		$(".del_version").click(function(){
			console.info("click");
			$.ajax({
				url: "/project/removeVersionPost",
				type: "POST",
				dataType: "json",
				data: {
					id: $(this).data("id")
				},
				success: function(data){
					if(data.status==0){
						$.sx.alert("操作成功！");
						setTimeout(function(){
							window.location.reload();
						}, 1500);
					} else {
						$.sx.alert(data.message);
					}
				}
			});
			return false;
		});

	});
</script>

</body>
</html>